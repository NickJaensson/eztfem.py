import numpy as np

def gauss_legendre(shape, **kwargs):
    """
    Gauss-Legendre integration points and weights
    
    Args:
        shape: shape of the domain:
            'line', interval [-1,1]
            'quad', domain [-1,1]x[-1,1]
            'triangle', reference triangle, left-lower half of [0,1]x[0,1]
        **kwargs: Optional keyword arguments to set optional parameters:
                  'n': the number of integration points in one direction. This only applies
                       to shape='line' and shape='quad', where the number of integration
                       points will be n and n^2, respectively.
                  'p': the order of the integration rule (=order polynomial integrated exact).
                       This only applies to shape='triangle'.
    Returns:
        x, w: coordinates and weights of the integration scheme.
    """
    n = kwargs.get('n', -1)
    p = kwargs.get('p', -1)

    if shape == 'line':
        if n < 0:
            raise ValueError('n must be specified for the integration rule')
        x, w = gauss_legendre_line(n)
    elif shape == 'quad':
        if n < 0:
            raise ValueError('n must be specified for the integration rule')
        x, w = gauss_legendre_quad(n)
    elif shape == 'triangle':
        if p < 0:
            raise ValueError('p must be specified for the integration rule')
        x, w = gauss_legendre_triangle(p)
    else:
        if isinstance(shape, str):
            ch = f'Invalid shape: {shape}'
        else:
            ch = 'shape must be a string'
        raise ValueError(ch)
    
    return x, w


# Gauss Legendre in 1D defined on the interval [-1,1]
def gauss_legendre_line(n):
    """
    n = number of integration points
    x(i), w(i), i=1,n = the reference coordinates and weights of the
      integration points
    """

    x = np.zeros(n)
    w = np.zeros(n)

    match n:
        case 1:
      
          x[0] = 0
          w[0] = 2
      
        case 2:
      
          x[0] = 2 * .2113248654051871177454256097490212 - 1
          x[1] = -x[0]
          w[:] = 1
      
        case 3:
      
          x[0] = 2 * .1127016653792583114820734600217600 - 1
          x[1] = 0
          x[2] = -x[0]
          w[0:2] = [ 5/9, 8/9 ]
          w[2] = w[0]

        case 4:
      
          x[0:2] = 2 * np.array([ .0694318442029737123880267555535953,
                                  .3300094782075718675986671204483776 ]) - 1
          x[2:4] = -x[1::-1]
          w[0:2] = np.array([ .1739274225687269286865319746109997,
                              .3260725774312730713134680253890002 ]) * 2
          w[2:4] = w[1::-1]

        case 5:
      
          x[0:2] = 2 * np.array([ .0469100770306680036011865608503036,
                                  .2307653449471584544818427896498955 ]) - 1
          x[2] = 0
          x[3:5] = -x[1::-1]
          w[0:3] = np.array([ .1184634425280945437571320203599586,
                              .2393143352496832340206457574178190,
                              128/450 ]) * 2
          w[3:5] = w[1::-1]
      
        case 6:
      
          x[0:3] = -2 * np.array([ .9662347571015760139061507772469973,
                                   .8306046932331322568306997975099527,
                                   .6193095930415984543152508608403560 ]) + 1
          x[3:6] = -x[2::-1]
          w[0:3] = np.array([ .0856622461895851725201480710863664,
                              .1803807865240693037849167569188581,
                              .2339569672863455236949351719947755 ]) * 2
          w[3:6] = w[2::-1]
      
        case 7:
      
          x[0:3] = -2 * np.array([ .9745539561713792622630948420239256,
                                  .8707655927996972199319323866403942,
                                  .7029225756886985834533032060384807 ]) + 1
          x[3] = 0
          x[4:7] = -x[2::-1]
          w[0:4] = np.array([ .0647424830844348466353057163395410,
                              .1398526957446383339507338857118898,
                              .1909150252525594724751848877444876,
                              .2089795918367346938775510204081633 ]) * 2
          w[4:7] = w[2::-1]
      
        case 8:
      
          x[0:4] = -2 * np.array([ .9801449282487681158417804342847365,
                                   .8983332387068133697957769682379152,
                                   .7627662049581644929088695245946232,
                                   .5917173212478249024697380711800920 ]) + 1
          x[4:8] = -x[3::-1]
          w[0:4] = np.array([ .0506142681451881295762656771549811,
                              .1111905172266872352721779972131204,
                              .1568533229389436436689811009933007,
                              .1813418916891809914825752246385978 ]) * 2
          w[4:8] = w[3::-1]
      
        case 9:
      
          x[0:4] = -2 * np.array([ .9840801197538130449177881014518364,
                                   .9180155536633178971497148940348674,
                                   .8066857163502951986543510196707371,
                                   .6621267117019044645192690073216683 ]) + 1
          x[4] = 0
          x[5:9] = -x[3::-1]
          w[0:5] = np.array([ .0406371941807872059859460790552618,
                              .0903240803474287020292360156214564,
                              .1303053482014677311593714347093164,
                              .1561735385200014200343152032922218,
                              .1651196775006298815822625346434870 ]) * 2
          w[5:9] = w[3::-1]
      
        case 10:
      
          x[0:5] = -2 * np.array([ .9869532642585858600389820060422260,
                                   .9325316833444922553660483442117465,
                                   .8397047841495122031171636825574368,
                                   .7166976970646235953996329715828921,
                                   .5744371694908156054424130005648600 ]) + 1
          x[5:10] = -x[4::-1]
          w[0:5] = np.array([ .0333356721543440687967844049466659,
                              .0747256745752902965728881698288487,
                              .1095431812579910219977674671140816,
                              .1346333596549981775456134607847347,
                              .1477621123573764350869464973256692 ]) * 2
          w[5:10] = w[4::-1]
      
        case 11:
      
          x[0:5] = -2 * np.array([ .9891143290730284964019690005614287,
                                   .9435312998840476495375788846519636,
                                   .8650760027870246620467081260155767,
                                   .7595480646034059079628628347293048,
                                   .6347715779761724861657659927004308 ]) + 1
          x[5] = 0
          x[6:11] = -x[4::-1]
          w[0:6] = np.array([ .0278342835580868332413768602212743,
                              .0627901847324523123173471496119701,
                              .0931451054638671257130488207158279,
                              .1165968822959952399592618524215876,
                              .1314022722551233310903444349452546,
                              .1364625433889503153572417641681711 ]) * 2
          w[6:11] = w[4::-1]
      
        case 12:
      
          x[6:12] = np.array([ .1252334085114689154724414,
                              .3678314989981801937526915,
                              .5873179542866174472967024,
                              .7699026741943046870368938,
                              .9041172563704748566784659,
                              .9815606342467192506905491 ])
          x[0:6] = -x[11:5:-1]
          w[6:12] = np.array([ .2491470458134027850005624,
                               .2334925365383548087608499,
                               .2031674267230659217490645,
                               .1600783285433462263346525,
                               .1069393259953184309602547,
                               .0471753363865118271946160 ])
          w[0:6] = w[11:5:-1]
      
        case 13:
      
          x[6:13] = np.array([ .0000000000000000000000000,
                               .2304583159551347940655281,
                               .4484927510364468528779129,
                               .6423493394403402206439846,
                               .8015780907333099127942065,
                               .9175983992229779652065478,
                               .9841830547185881494728294 ])
          x[0:6] = -x[12:6:-1]
          w[6:13] = np.array([ .2325515532308739101945895,
                               .2262831802628972384120902,
                               .2078160475368885023125232,
                               .1781459807619457382800467,
                               .1388735102197872384636018,
                               .0921214998377284479144218,
                               .0404840047653158795200216 ])
          w[0:6] = w[12:6:-1]
      
        case 14:
      
          x[7:14] = np.array([ .1080549487073436620662447,
                               .3191123689278897604356718,
                               .5152486363581540919652907,
                               .6872929048116854701480198,
                               .8272013150697649931897947,
                               .9284348836635735173363911,
                               .9862838086968123388415973 ])
          x[0:7] = -x[13:6:-1]
          w[7:14] = np.array([ .2152638534631577901958764,
                               .2051984637212956039659241,
                               .1855383974779378137417166,
                               .1572031671581935345696019,
                               .1215185706879031846894148,
                               .0801580871597602098056333,
                               .0351194603317518630318329 ])
          w[0:7] = w[13:6:-1]
      
        case 15:
      
          x[7:15] = np.array([ .0000000000000000000000000,
                               .2011940939974345223006283,
                               .3941513470775633698972074,
                               .5709721726085388475372267,
                               .7244177313601700474161861,
                               .8482065834104272162006483,
                               .9372733924007059043077589,
                               .9879925180204854284895657 ])
          x[0:7] = -x[14:7:-1]
          w[7:15] = np.array([ .2025782419255612728806202,
                               .1984314853271115764561183,
                               .1861610000155622110268006,
                               .1662692058169939335532009,
                               .1395706779261543144478048,
                               .1071592204671719350118695,
                               .0703660474881081247092674,
                               .0307532419961172683546284 ])
          w[0:7] = w[14:7:-1]
      
        case 16:
      
          x[8:16] = np.array([ .0950125098376374401853193,
                               .2816035507792589132304605,
                               .4580167776572273863424194,
                               .6178762444026437484466718,
                               .7554044083550030338951012,
                               .8656312023878317438804679,
                               .9445750230732325760779884,
                               .9894009349916499325961542 ])
          x[0:8] = -x[15:7:-1]
          w[8:16] = np.array([ .1894506104550684962853967,
                               .1826034150449235888667637,
                               .1691565193950025381893121,
                               .1495959888165767320815017,
                               .1246289712555338720524763,
                               .0951585116824927848099251,
                               .0622535239386478928628438,
                               .0271524594117540948517806 ])
          w[0:8] = w[15:7:-1]
      
        case 17:
      
          x[8:17] = np.array([ .0000000000000000000000000,
                               .1784841814958478558506775,
                               .3512317634538763152971855,
                               .5126905370864769678862466,
                               .6576711592166907658503022,
                               .7815140038968014069252301,
                               .8802391537269859021229557,
                               .9506755217687677612227170,
                               .9905754753144173356754340 ])
          x[0:8] = -x[16:8:-1]
          w[8:17] = np.array([ .1794464703562065254582656,
                               .1765627053669926463252710,
                               .1680041021564500445099707,
                               .1540457610768102880814316,
                               .1351363684685254732863200,
                               .1118838471934039710947884,
                               .0850361483171791808835354,
                               .0554595293739872011294402,
                               .0241483028685479319601100 ])
          w[0:8] = w[16:8:-1]
      
        case 18:
      
          x[9:18] = np.array([ .0847750130417353012422619,
                               .2518862256915055095889729,
                               .4117511614628426460359318,
                               .5597708310739475346078715,
                               .6916870430603532078748911,
                               .8037049589725231156824175,
                               .8926024664975557392060606,
                               .9558239495713977551811959,
                               .9915651684209309467300160 ])
          x[0:9] = -x[17:8:-1]
          w[9:18] = np.array([ .1691423829631435918406565,
                               .1642764837458327229860538,
                               .1546846751262652449254180,
                               .1406429146706506512047313,
                               .1225552067114784601845191,
                               .1009420441062871655628140,
                               .0764257302548890565291297,
                               .0497145488949697964533349,
                               .0216160135264833103133427 ])
          w[0:9] = w[17:8:-1]
      
        case 19:
      
          x[9:19] = np.array([ .0000000000000000000000000,
                               .1603586456402253758680961,
                               .3165640999636298319901173,
                               .4645707413759609457172671,
                               .6005453046616810234696382,
                               .7209661773352293786170959,
                               .8227146565371428249789225,
                               .9031559036148179016426609,
                               .9602081521348300308527788,
                               .9924068438435844031890177 ])
          x[0:9] = -x[18:9:-1]
          w[9:19] = np.array([ .1610544498487836959791636,
                               .1589688433939543476499564,
                               .1527660420658596667788554,
                               .1426067021736066117757461,
                               .1287539625393362276755158,
                               .1115666455473339947160239,
                               .0914900216224499994644621,
                               .0690445427376412265807083,
                               .0448142267656996003328382,
                               .0194617882297264770363120 ])
          w[0:9] = w[18:9:-1]
      
        case 20:
      
          x[10:20] = np.array([ .0765265211334973337546404,
                                .2277858511416450780804962,
                                .3737060887154195606725482,
                                .5108670019508270980043641,
                                .6360536807265150254528367,
                                .7463319064601507926143051,
                                .8391169718222188233945291,
                                .9122344282513259058677524,
                                .9639719272779137912676661,
                                .9931285991850949247861224 ])
          x[0:10] = -x[19:9:-1]
          w[10:20] = np.array([ .1527533871307258506980843,
                                .1491729864726037467878287,
                                .1420961093183820513292983,
                                .1316886384491766268984945,
                                .1181945319615184173123774,
                                .1019301198172404350367501,
                                .0832767415767047487247581,
                                .0626720483341090635695065,
                                .0406014298003869413310400,
                                .0176140071391521183118620 ])
          w[0:10] = w[19:9:-1]

        case _:
    
          raise ValueError(f"Invalid number of points, n = {n}")

    return x, w

# Gauss Legendre in 2D defined on the region [-1,1]x[-1,1]
def gauss_legendre_quad(n):
    """
    n = number of integration points in one dimension
    x(i,1:2), w(i), i=1,n^2 = the reference coordinates and weights of
       the integration points
    """
    x1, w1 = gauss_legendre_line(n)

    m = n**2
    x = np.zeros((m, 2))
    w = np.zeros(m)

    for i in range(n):
        for j in range(n):
            ip = i + n * (j)
            x[ip, 0] = x1[i]
            x[ip, 1] = x1[j]
            w[ip] = w1[i] * w1[j]

    return x, w

# Gauss Legendre in 1D defined on the interval [-1,1]
def gauss_legendre_triangle(p):
    """
    p = order of integration rule (=order polynomial integrated exact).
    x(i,1:2), w(i), i=1,ni = the reference coordinates and weights of
       the integration points  
     the reference region of a triangle is
        
        1 |\               eta \in [0,1] 
        ^ |  \             xi  \in [0,1]
    eta | |    \           xi + eta <= 1
          |      \
        0 ---------
          0  xi -> 1
  
  
    The numerical values are based on:
  
    L. Zhang, T. Cui, H. Liu, "A set of symmetric quadrature rules on triangles
    and tetrahedra", Journal of Computational Mathematics, Vol. 27, No. 1, 2009,
    89-96.
    """

    # number of integration points
    ni = np.array([  1,  3,  6,  6,  7, 12, 15, 16, 19, 25, 
                    28, 33, 37, 46, 52, 55, 61, 72, 73, 88, 91 ])

    m = ni[p-1]

    match p:
        case 1:

            x = np.reshape ( [ 
                        perm3(.3333333333333333333333333333333333)
                                            ], [m,2] )
            
            w = np.array([ dup3(1) ])

        case(2):

            x = np.reshape ( [
                        perm21(.1666666666666666666666666666666667)
                                            ], [m,2])
            
            w = dup21(.3333333333333333333333333333333333)

        case(3):
            
            x = np.reshape ( np.concatenate (
                      ( perm21(.1628828503958919109001618041849063),
                        perm21(.4779198835675637000000000000000000) ) ), [m,2] )
            
            w = np.concatenate ( (dup21(.2811498024409796482535143227020770),
                                  dup21(.0521835308923536850798190106312564) ) )

        case(4):

            x = np.reshape ( np.concatenate (
                      ( perm21(.4459484909159648863183292538830519),
                        perm21(.0915762135097707434595714634022015) ) ), [m,2] )
            
            w = np.concatenate ( (dup21(.2233815896780114656950070084331228),
                                  dup21(.1099517436553218676383263249002105)) )

        case(5):

            x = np.reshape ( np.concatenate (
                       ( perm21(.1012865073234563388009873619151238),
                         perm21(.4701420641051150897704412095134476),
                         perm3(.3333333333333333333333333333333333) )) , [m,2] )

            w = np.concatenate ( (dup21(.1259391805448271525956839455001813),
                                  dup21(.1323941527885061807376493878331519),
                                  dup3(.2250000000000000000000000000000000)) )
            
        case(6):

            x = np.reshape ( np.concatenate ( (
                        perm21(.0630890144915022283403316028708192),
                        perm21(.2492867451709104212916385531070191),
                        perm111(.0531450498448169473532496716313981,
                                .3103524510337844054166077339565522) )
                                            ), [m,2] )
            
            w = np.concatenate (( dup21(.0508449063702068169209368091068690),
                                  dup21(.1167862757263793660252896113855794),
                                  dup111(.0828510756183735751935534564204425) ))

        case(7):

            x = np.reshape ( np.concatenate (
                        (perm21(.0282639241560763402235960069132400),
                        perm21(.4743113232672225752752252279318165),
                        perm21(.2411433258498488102541435126703621),
                        perm111(.7612227480245238000000000000000000,
                                .0462708777988089106409255939170205))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup21(.0135338625156655615668230924525939),
                        dup21(.0789512544320109813765214502977033),
                        dup21(.1286079278189060745566555330895234),
                        dup111(.0561201442833753579166666287467563)) )

        case(8):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.1705693077517602066222935014914645),
                        perm21(.0505472283170309754584235505965989),
                        perm21(.4592925882927231560288155144941693),
                        perm111(.2631128296346381134217857862846436,
                                .0083947774099576053372138345392944))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.1443156076777871682510911104890646),
                        dup21(.1032173705347182502817915502921290),
                        dup21(.0324584976231980803109259283417806),
                        dup21(.0950916342672846247938961043885843),
                        dup111(.0272303141744349942648446900739089)) )

        case(9):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.4896825191987376277837069248361928),
                        perm21(.0447295133944527098651065899662764),
                        perm21(.4370895914929366372699303644353550),
                        perm21(.1882035356190327302409612804673356),
                        perm111(.7411985987844980206900798735234238,
                                .2219629891607656956751025276931911))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0971357962827988338192419825072886),
                        dup21(.0313347002271390705368548312872093),
                        dup21(.0255776756586980312616787985589998),
                        dup21(.0778275410047742793167393562994040),
                        dup21(.0796477389272102530328917742640453),
                        dup111(.0432835393772893772893772893772894)) )

        case(10):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.4272731788467755380904427175154472),
                        perm21(.1830992224486750205215743848502200),
                        perm21(.4904340197011305874539712223768484),
                        perm21(.0125724455515805327313290850210413),
                        perm111(.6542686679200661406665700955876279,
                                .3080460016852477000000000000000000),
                        perm111(.1228045770685592734301298174812812,
                                .0333718337393047862408164417747804))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0809374287976228802571131238165019),
                        dup21(.0772985880029631216825069823803434),
                        dup21(.0784576386123717313680939208343967),
                        dup21(.0174691679959294869176071632906781),
                        dup21(.0042923741848328280304804020901319),
                        dup111(.0374688582104676429790207654850445),
                        dup111(.0269493525918799596454494795810967)) )

        case(11):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.0309383552454307848951950149913047),
                        perm21(.4364981811341288419176152765599732),
                        perm21(.4989847637025932662879869838313909),
                        perm21(.2146881979585943366068758138782509),
                        perm21(.1136831040421133902052931562283618),
                        perm111(.8256187661648629043588062003083580,
                                .1597423045918501898008607882250075),
                        perm111(.6404723101348652676770365908189668,
                                .3117837157095990000000000000000000))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0811779602968671595154759687498236),
                        dup21(.0123240435069094941184739010162328),
                        dup21(.0628280097444101072833394281602940),
                        dup21(.0122203790493645297552122150039379),
                        dup21(.0677013489528115099209888618232256),
                        dup21(.0402196936288516904235668896075687),
                        dup111(.0147622727177161013362930655877821),
                        dup111(.0407279964582990396603369584816179)) )

        case(12):

            x = np.reshape ( np.concatenate (
                        (perm21(.0213173504532103702468569755157282),
                        perm21(.2712103850121159223459513403968947),
                        perm21(.1275761455415859246738963251542836),
                        perm21(.4397243922944602729797366234843611),
                        perm21(.4882173897738048825646620652588110),
                        perm111(.6958360867878034221416355232360725,
                                .2813255809899395482481306929745527),
                        perm111(.8580140335440726305905366166261782,
                                .1162519159075971412413541478426018),
                        perm111(.6089432357797878068561924377637101,
                                .2757132696855141939747963460797640))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup21(.0061662610515590172338664837852304),
                        dup21(.0628582242178851003542705130928825),
                        dup21(.0347961129307089429893283972949994),
                        dup21(.0436925445380384021354572625574750),
                        dup21(.0257310664404553354177909230715644),
                        dup111(.0223567732023034457118390767023200),
                        dup111(.0173162311086588923716421008110341),
                        dup111(.0403715577663809295178286992522368)) )

        case(13):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.4269414142598004060208125350313742),
                        perm21(.2213722862918329006548125547050791),
                        perm21(.0215096811088431838692913135340521),
                        perm21(.4890769464525393499006897190902044),
                        perm111(.6235459955536755708158543531862366,
                                .3084417608921177746584718525412453),
                        perm111(.8647077702954427753025459508956932,
                                .1109220428034633954128695452216745),
                        perm111(.7485071158999521951730185957887097,
                                .1635974010678504802338879017109572),
                        perm111(.7223577931241879652606201323047840,
                                .2725158177734296661800504643540868))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0679600365868316442817744246808849),
                        dup21(.0556019675304533287072574660104615),
                        dup21(.0582784851191999814047670835133398),
                        dup21(.0060523371035391718417928000322908),
                        dup21(.0239944019288947307737107994509597),
                        dup111(.0346412761408483704659868285109182),
                        dup111(.0149654011051656672632458571329034),
                        dup111(.0241790398115938191374457455730608),
                        dup111(.0095906810035432627225950901661109)) )

        case(14):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.0099797608064584324152935295820524),
                        perm21(.4799778935211883898105528650883899),
                        perm21(.1538119591769669000000000000000000),
                        perm21(.0740234771169878100000000000000000),
                        perm21(.1303546825033300000000000000000000),
                        perm21(.2306172260266531342996053700983831),
                        perm21(.4223320834191478241144087137913939),
                        perm111(.7862373859346610033296221140330900,
                                .1906163600319009042461432828653034),
                        perm111(.6305521436606074416224090755688129,
                                .3623231377435471446183267343597729),
                        perm111(.6265773298563063142335123137534265,
                                .2907712058836674150248168174816732),
                        perm111(.9142099849296254122399670993850469,
                                .0711657108777507625475924502924336))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0585962852260285941278938063477560),
                        dup21(.0017351512297252675680618638808094),
                        dup21(.0261637825586145217778288591819783),
                        dup21(.0039197292424018290965208275701454),
                        dup21(.0122473597569408660972869899262505),
                        dup21(.0281996285032579601073663071515657),
                        dup21(.0508870871859594852960348275454540),
                        dup21(.0504534399016035991910208971341189), 
                        dup111(.0170636442122334512900253993849472),
                        dup111(.0096834664255066004075209630934194),
                        dup111(.0363857559284850056220113277642717),
                        dup111(.0069646633735184124253997225042413)) )

        case(15):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.2273322188191428742025043684922941),
                        perm21(.4971625774318874298738098000160233),
                        perm21(.4788497353489545833392292001438526),
                        perm21(.4049860390982719916972446423426920),
                        perm21(.0159312166717444321134277329412690),
                        perm21(.1655832624260814000000000000000000),
                        perm21(.0731336047192287277268738121073244),
                        perm111(.6652607330722139390623644133856912,
                                .3163528393449472300863381309502453),
                        perm111(.7125219872425455330488490116233878,
                                .0934607511499175300000000000000005),
                        perm111(.5596483622353932184122484540192300,
                                .3442290175821932000000000000000016),
                        perm111(.8104765976190768630468327302905713,
                                .1710472483142579515476503319255848),
                        perm111(.9160756440317311885646088387783200,
                                .0730559964791864896129490819274250))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0440387108784342798530173272149339),
                        dup21(.0461847871820269799487156676019167),
                        dup21(.0064989066173327165268828034928102),
                        dup21(.0179936142526584032446699241671566),
                        dup21(.0417731050391413541196860605641460),
                        dup21(.0030595476091164665484301699283448),
                        dup21(.0020124350525586473440903187565405),
                        dup21(.0167756109305091223261114568879588),
                        dup111(.0154607491897142748660880304092474),
                        dup111(.0284998903395474233927395587533020),
                        dup111(.0320943504834895956420992357370957),
                        dup111(.0115085816368707112840232437732419),
                        dup111(.0046143065289671031435871760918541)) )

        case(16):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.0817949831313738726414655931188610),
                        perm21(.1653006019697796506267619329335566),
                        perm21(.4685921053494613866946028972966056),
                        perm21(.0144388134454166826141089566956602),
                        perm21(.2417842853917833534068944592932077),
                        perm21(.4953103429877699640654950868774055),
                        perm111(.6505134026613522994311446848416867,
                                .3313997445370895565813231681825939),
                        perm111(.6040112814959970398494041030359670,
                                .3032471627499421850415521780783469),
                        perm111(.8021682575747416636168619478116671,
                                .1880280595212371734441821142939888),
                        perm111(.7565056064428283965511540757580608,
                                .1835046685222968636823802774370004),
                        perm111(.4659384387141181848838107335915464,
                                .3596459487975046000000000000000100),
                        perm111(.9063948439920415013624996618653400,
                                .0771943712957554322825152250527139))
                                            ), [m,2] )
        
            w = np.concatenate (  (dup3(.0480221886803770905518394045805199),
                        dup21(.0147091003068019271034036428618692),
                        dup21(.0295445865493192559953097267964641),
                        dup21(.0261250173510883774985975654917156),
                        dup21(.0027803873523900069750030161386621),
                        dup21(.0318217730005366495034272900559496),
                        dup21(.0086458343495096599011737341698489),
                        dup111(.0143003329044953651466164253682521),
                        dup111(.0278497772036008299522298734239535),
                        dup111(.0070416734066360975623701880892807),
                        dup111(.0178998382599337286017702090758108),
                        dup111(.0274582003843497630724700381009172),
                        dup111(.0072997969394317620841125440877777)) )

        case(17):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.0956985088627109399431625786023763),
                        perm21(.1701386396787754467232472307956844),
                        perm21(.4180206858679549762226346423934278),
                        perm21(.4965814805066249549705403530622792),
                        perm21(.0416621148288076427920788515983419),
                        perm21(.4679329057294235782681900853617119),
                        perm111(.9695311989037220561945405830595324,
                                .0289250916202182460715280477140682),
                        perm111(.7597243875386241295553271953226612,
                                .2344417552635687745426605309129788),
                        perm111(.2954993169683015000000000000000100,
                                .4959112466607535754230345000437552),
                        perm111(.6256063821576970270701920926669370,
                                .3534176945414970676263249907709938),
                        perm111(.8721744472331847929031830014156074,
                                .1127286418142197686188888676807420),
                        perm111(.7475123194400060400624067817608753,
                                .1990702787978578813133914398155831),
                        perm111(.5988687908832380598061676972635110,
                                .3035851830713260765320205120458494))
                                            ), [m,2] )
        
            w = np.concatenate (  (dup3(.0447568714443446293718364767042551),
                                   dup21(.0173668850267477964504911176477604),
                                   dup21(.0305993480761035327226656472689570),
                                   dup21(.0285877085785997802070400912176892),
                                   dup21(.0066474319297536932323184955454668),
                                   dup21(.0074761894020185118222455734708010), 
                                   dup21(.0250499865038387453145589519055078),
                                   dup111(.0014798108921196449448095368275048),
                                   dup111(.0051211362467481060658943504057326),
                                   dup111(.0273173593695928059185316898423957), 
                                   dup111(.0140057286759092815978663321140118),
                                   dup111(.0078092756974583600981098732328800),
                                   dup111(.0181657284597916721760720775172237),
                                   dup111(.0274443739924583277620834554147845)) )

        case(18):

            x = np.reshape ( np.concatenate (
                        (perm21(.0732708864643828315786196714876895),
                        perm21(.0039177489832282316427840744195806),
                        perm21(.4675973189887110616515129966229624),
                        perm21(.4179162109674113120121268105139935),
                        perm111(.1653816933602894800544902692391766,
                                .5636967056608707538051458939380737),
                        perm111(.2875008944057839899961939131396606,
                                .2860423261392047491209581074803029),
                        perm111(.1258893143198247960170648399490380,
                                .6960432186424611957925748602819539),
                        perm111(.0632219159465026144935750801169980,
                                .7605455518876824326145947637978687),
                        perm111(.0789102274540205177520722103754889,
                                .5920196312717585633226205754022254),
                        perm111(.0380580535067857143261189915962621,
                                .6836812596359998524801240874538131),
                        perm111(.0142903521304540256499241103130749, 
                                .8517040371370558150285216534427664),
                        perm111(.0129672723432531723123416343300903,
                                .5747324928881490288994509386896897),
                        perm111(.0076485948208408993307926288182273,
                                .7355104408307292987031352244816406),
                        perm111(.0127104605722554679311424918135822,
                                .9393450876437317887074042026828225))
                                            ), [m,2] )
        
            w = np.concatenate (  (dup21(.0139778616452860209795840079905549),
                        dup21(.0005549069792132137850684555152509),
                        dup21(.0210268138197046690284298685162450),
                        dup21(.0340182121799276997472265274182211),
                        dup111(.0279101658047749951418434740078169),
                        dup111(.0182146861271508661267339566206858),
                        dup111(.0142670236581097930775198241095567),
                        dup111(.0142371230906750507043127637741560),
                        dup111(.0192575838546747877991373836820213),
                        dup111(.0097051322843806411487822763323902),
                        dup111(.0076297881343321289957824556338534),
                        dup111(.0106187391363503447944635436705283),
                        dup111(.0057106698032758388134142143826895),
                        dup111(.0043268574608764182945223447328327)) )

        case(19):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.4896099870730063319661310657482982),
                        perm21(.4545368926978926620467593905357283),
                        perm21(.4014166806494311873939956238106886),
                        perm21(.2555516544030976113221817681092679),
                        perm21(.1770779421521295516426752065159011),
                        perm21(.1100610532279518613000849516773740),
                        perm21(.0555286242518396712486784124713557),
                        perm21(.0126218637772286684902347667787060),
                        perm111(.6006337947946450000000000000000000,
                                .3957547873569428623047946940658279),
                        perm111(.1344667545307797856120431989326469,
                                .5576032615887839683639532425011810),
                        perm111(.7209870258173650552166529023382789,
                                .2645669484065202080403017349012149),
                        perm111(.5945270689558709246138892880265067,
                                .3585393522059505884249269906459009),
                        perm111(.8393314736808385786174900771484052,
                                .1578074059685947447376736033595065),
                        perm111(.2238614240979156913033693895065364,
                                .7010879789261733673232883365595116),
                        perm111(.8229313240698566316274715591605332,
                                .1424216011133834373155747568772374),
                        perm111(.9243442526207840294558591379015631,
                                .0654946280829377033923265249859256))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0329063313889186520836143448464750),
                                   dup21(.0103307318912720533670399635717483),
                                   dup21(.0223872472630163925291845560351627),
                                   dup21(.0302661258694680708652801909825912),
                                   dup21(.0304909678021977810000315865785204),
                                   dup21(.0241592127416409049118480309866400),
                                   dup21(.0160508035868008752916227702764295),
                                   dup21(.0080845802617840604818056732421944),
                                   dup21(.0020793620274847807513475016743984),
                                   dup111(.0038848769049813897567049919927727),
                                   dup111(.0255741606120219038929297019526003),
                                   dup111(.0088809035733380577455259247035175),
                                   dup111(.0161245467617313912197852693278377),
                                   dup111(.0024919418174906754405846475759496),
                                   dup111(.0182428401189505783776657132097361),
                                   dup111(.0102585637361985213080480700423581),
                                   dup111(.0037999288553019139790731537136397)) )

        case(20):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.2158743059329919731902545438401828),
                        perm21(.0753767665297472780972854309459163),
                        perm21(.0103008281372217921136862160096969),
                        perm21(.4936022112987001655119208321450536),
                        perm21(.4615509381069252967410487102915180),
                        perm111(.3286214064242369933034974609509133,
                                .4293405702582103752139588004663984),
                        perm111(.2604803617865687564195930170811535,
                                .1015775342809694461687550061961797),
                        perm111(.1370742358464553000000000000000000,
                                .7100659730011301599879040745464079),
                        perm111(.1467269458722997843041609884874530,
                                .4985454776784148493896226967076119),
                        perm111(.0269989777425532900000000000000000,
                                .0491867226725820016197037125775872),
                        perm111(.0618717859336170268417124700122339,
                                .7796601465405693953603506190768108),
                        perm111(.0477243674276219962083526801042934,
                                .3704915391495476369201496202567388),
                        perm111(.1206005151863643799672337870400794,
                                .8633469487547526484979879960925217),
                        perm111(.0026971477967097876716489145012827,
                                .0561949381877455029878923019865887),
                        perm111(.0030156332779423626572762598234710,
                                .2086750067484213509575944630613577),
                        perm111(.0299053757884570188069287738643386,
                                .7211512409120340910281041502050941),
                        perm111(.0067566542224609885399458175192278,
                                .6400554419405418899040536682721647))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0125376079944966565735856367723948),
                                   dup21(.0274718698764242137484535496073598),
                                   dup21(.0097652722770514230413646914294237),
                                   dup21(.0013984195353918235239233631597867),
                                   dup21(.0092921026251851826304282034030330),
                                   dup21(.0165778760323669253260236250351840),
                                   dup111(.0206677623486650769614219700129729),
                                   dup111(.0208222355211545073068785561993297),
                                   dup111(.0095686384198490606888758450458320),
                                   dup111(.0244527709689724638856439207024089),
                                   dup111(.0031557306306305340038264003207296),
                                   dup111(.0121367963653212969370133090807574),
                                   dup111(.0149664801438864490365249118515707),
                                   dup111(.0063275933217777395693240327504398),
                                   dup111(.0013425603120636958849798512981433),
                                   dup111(.0027760769163475540677293561558015),
                                   dup111(.0107398444741849415551734474479517),
                                   dup111(.0053678057381874532052474100212697)) )

        case(21):

            x = np.reshape ( np.concatenate (
                        (perm3(.3333333333333333333333333333333333),
                        perm21(.2009352770650852798729618515641637),
                        perm21(.4376591659619271797318338441880541),
                        perm21(.0034339564905961768509599122096049),
                        perm21(.0466434847753067534951762404321419),
                        perm21(.3864222517630714909403520241677264),
                        perm21(.0954354711085309101085716810414760),
                        perm111(.9555138033504563605013147251467712,
                                .0357186278731633582380416089754387),
                        perm111(.8866388134288682261249005746914376,
                                .1081432249156462115273886110463127),
                        perm111(.7842628458804341542966439903981954,
                                .2074644495998764568243804295157274),
                        perm111(.8829239550502000327113489873168897,
                                .0856847087203169400000000000000100),
                        perm111(.6689919644410772404913224832098946,
                                .3214940030142888168816832126834860),
                        perm111(.5520721210355609641571609652527788,
                                .4379422187933413835523680769629170),
                        perm111(.7975929655965685676293142232957258,
                                .1619164530635778567510067702038591),
                        perm111(.6775147151197714846349911663441326,
                                .2745047674019949038590029729073332),
                        perm111(.5429974155890916053311361168391934,
                                .4053359980750069279498908953763256),
                        perm111(.7054599055699685616588563415406017,
                                .1877376806564353427728167439451200),
                        perm111(.5748005730665084622159824505498500,
                                .3056968347660551665127925566498432),
                        perm111(.4717788085046148166039770401349242,
                                .3121444668708908816708046058155764))
                                            ), [m,2] )
            
            w = np.concatenate (  (dup3(.0275622569528764809669070448245143),
                                   dup21(.0220602154134885011913507340331164),
                                   dup21(.0234600159386714884930134449523000),
                                   dup21(.0003268895950471905462145575015465),
                                   dup21(.0032653194629399682343353040958667),
                                   dup21(.0117564629154127977043079692133821),
                                   dup21(.0117807684199115168455575790986761),
                                   dup111(.0022688108188011408053357043343043),
                                   dup111(.0025960109644363200606737836654882),
                                   dup111(.0046345297858718602123478905615969),
                                   dup111(.0047943360545488579348574487199119),
                                   dup111(.0057124788367236115672506383429634),
                                   dup111(.0058658276043221216369557987000023),
                                   dup111(.0094137630590915875898182685203471),
                                   dup111(.0134149437966564249100220266108931),
                                   dup111(.0157169180920832459435000011378462),
                                   dup111(.0168636830144369045916509638861999),
                                   dup111(.0213900270853200983778322980803590),
                                   dup111(.0230767921894926813678808755218915)) )

        case _:

            raise ValueError(f"invalid polynomial order, p = {p}")
       
    return x, w

def dup3(a):
    return np.array([a / 2])

def dup21(a):
    return np.array([a/2 for i in range(3)])

def dup111(a):
    return np.array([a/2 for i in range(6)])

def perm3(a):
    return np.array([a, a])

def perm21(a):
    b = 1 - 2 * a
    return np.array([a, a, a, b, b, a])

def perm111(a, b):
    c = 1 - a - b
    return np.array([a, b, c, a, b, c, b, a, c, b, a, c])